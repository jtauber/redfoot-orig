<r:module name="rss" xmlns:r="http://redfoot.sourceforge.net/2001/01/">

RSS_ITEM = "http://purl.org/rss/1.0/item"
RSS_TITLE = "http://purl.org/rss/1.0/title"

# TODO: ??
# RSS_DESCRIPTION = "http://purl.org/rss/1.0/description"
RSS_DESCRIPTION = "http://purl.org/dc/elements/1.1/description"

RSS_LINK = "http://purl.org/rss/1.0/link"

from redfoot.util import *


<r:class name="RSS">

def __init__(self, node):

    def toRelativeURL(path):
        import sys
        from os.path import join, dirname
        from urllib import pathname2url
        libDir = dirname(sys.modules["redfoot.modules.rss"].__file__)
        return pathname2url(join(libDir, path))

    node.connectTo(toRelativeURL("rssSchema.rdf"), None)
    node.connectTo(toRelativeURL("dces.xml"), None)    


def load_rss(self, request, response):
    if hasattr(self, 'rss_store') and self.rss_store:
        self.rednode.neighbours.stores.removeStore(self.rss_store)
        self.rss_store = None
    store = Local()
    store.load(request.getParameters()['url'], None)
    self.rednode.neighbours.stores.addStore(store)
    self.rss_store = store


def rss(self, request, response):
    self.subclass(request, response, RSS_ITEM, self.rss_row)


<r:response name="rss_row" args="triple row">
<r:exec>
if row % 2 == 0:
    color = 'DDDDFF'
else:
    color = 'DDFFDD'
</r:exec>
<dl style="margin: 0px; padding: 2px 5px; background: #{color};">
  <dt style="padding: 0px; margin: 0px;">
      <r:eval>get_property_value(self.rednode, triple[0], RSS_TITLE, '')</r:eval>
  </dt>
  <dd style="padding-bottom: 10px">
    <r:eval>get_property_value(self.rednode, triple[0], RSS_DESCRIPTION, '')</r:eval>
  </dd>
  <dd style="padding-bottom: 10px">
    <a href="{get_property_value(self.rednode, triple[0], RSS_LINK, '')}">Read Story</a>
  </dd>
</dl>
</r:response>

</r:class>

</r:module>
